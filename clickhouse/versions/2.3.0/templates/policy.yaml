{{ include "clickhouse.validateStorage" . }}
---
kind: policy
name: {{ include "clickhouse.policy.name" . }}
description: Clickhouse policy
tags: {{- include "clickhouse.tags" . | nindent 4 }}
bindings:
  - permissions:
      - reveal
    principalLinks:
      - //gvc/{{ .Values.gvc.name }}/identity/{{ include "clickhouse.identity.name" . }}
targetKind: secret
targetLinks:
  - //secret/{{ include "clickhouse.secretDatabase.name" . }}
  - //secret/{{ include "clickhouse.secretKeeper.name" . }}
  - //secret/{{ include "clickhouse.secretServer.name" . }}
  {{- if eq .Values.provider "aws" }}
  - //secret/{{ include "clickhouse.secretS3.name" . }}
  {{- end }}
  {{- if eq .Values.provider "gcp" }}
  - //secret/{{ include "clickhouse.secretGCS.name" . }}
  {{- end }}
