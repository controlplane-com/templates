kind: policy
name: {{ include "kafka.name" . }}
origin: default
bindings:
  - permissions:
      - reveal
    principalLinks:
      - //gvc/{{ .Values.cpln.gvc }}/identity/{{ include "kafka.name" . }}
targetKind: secret
targetLinks:
  - //secret/{{ include "kafka.name" . }}-controller-configuration
  - //secret/{{ include "kafka.name" . }}-init
  - //secret/{{ include "kafka.name" . }}-secrets
{{- if .Values.jmx_exporter }}
  - //secret/{{ include "kafka.name" . }}-jmx-exporter-conf
{{- end }}
{{- range $key, $listener := .Values.kafka.listeners }}
{{- if and $listener.sasl $listener.sasl.admin $listener.sasl.admin.existingSecret $listener.sasl.admin.existingSecret.enabled }}
  - //secret/{{ $listener.sasl.admin.existingSecret.name }}
{{- end }}
{{- end }}