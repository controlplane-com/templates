---
kind: identity
name: {{ include "opensearch.identity.name" . }}
description: OpenSearch identity
tags: {{ include "opensearch.tags" . | nindent 4 }}
{{- if and .Values.backup.enabled .Values.backup.provider "aws" }}
aws:
  cloudAccountLink: //cloudaccount/{{ .Values.backup.aws.cloudAccountName }}
  policyRefs:
    - cpln-connector
    - aws::ReadOnlyAccess
    - {{ .Values.backup.aws.policyName  | quote }}
{{- end }}
{{- if and .Values.backup.enabled .Values.backup.provider "gcp" }}
gcp:
  bindings:
    - resource: //storage.googleapis.com/projects/_/buckets/{{ .Values.backup.gcp.bucket }}
      roles:
        - roles/storage.objectAdmin
  cloudAccountLink: //cloudaccount/{{ .Values.backup.gcp.cloudAccountName }}
  scopes:
    - https://www.googleapis.com/auth/cloud-platform
{{- end }}

{{- if .Values.enable_demo_logs }}
---
kind: identity
name: {{ include "opensearch.demoLogsIdentity.name" . }}
description: Identity for OpenSearch demo logs app
tags: {{ include "opensearch.tags" . | nindent 4 }}
{{- end }}