{{- if .Values.enable_demo_logs }}
kind: secret
name: {{ include "opensearch.secretFluentBitDemo.name" .}}
description: Fluent Bit config for OpenSearch demo logs app
tags: {{ include "opensearch.tags" . | nindent 4 }}
type: opaque
data:
  encoding: plain
  payload: |
    [SERVICE]
        Flush        5
        Daemon       Off
        Log_Level    info

    [INPUT]
        Name              tail
        Path              /var/log/app/*.log
        Parser            json
        Tag               app.*
        Refresh_Interval  5
        Read_from_Head    true

    [FILTER]
        Name    modify
        Match   *
        Add     cluster demo-cluster
        Add     environment demo

    [OUTPUT]
        Name            opensearch
        Match           *
        Host            {{ include "opensearch.name" . }}.{{ .Values.global.cpln.gvc}}.cpln.local
        Port            9200
        Index           demo-logs
        Type            _doc
        Suppress_Type_Name On
        Retry_Limit     5
{{- end }}